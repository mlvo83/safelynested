<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Details - Facilitator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 24px;
            font-weight: bold;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        .badge-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-confirmed {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-checked_in {
            background: #e0e7ff;
            color: #3730a3;
        }

        .badge-checked_out {
            background: #fce7f3;
            color: #9f1239;
        }

        .badge-completed {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-no_show {
            background: #fed7aa;
            color: #9a3412;
        }

        .payment-badge {
            background: #e0e7ff;
            color: #3730a3;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .info-item {
            padding: 15px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
        }

        .section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e5e7eb;
        }

        .section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .location-card, .referral-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .location-card h4, .referral-card h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .location-card p, .referral-card p {
            color: #666;
            margin: 5px 0;
        }

        .notes-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .notes-section h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .notes-section p {
            color: #666;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #e5e7eb;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-checkin {
            background: #10b981;
            color: white;
        }

        .btn-checkout {
            background: #3b82f6;
            color: white;
        }

        .btn-cancel {
            background: #ef4444;
            color: white;
        }

        .btn-back {
            background: #6c757d;
            color: white;
        }

        .btn-referral {
            background: #667eea;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-modal-cancel {
            background: #6c757d;
            color: white;
        }

        .cost-display {
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }
    </style>
</head>
<body>
<nav class="navbar">
    <div class="navbar-brand">Facilitator Portal</div>
    <a th:href="@{/facilitator/bookings}" class="nav-link">‚Üê Back to Bookings</a>
</nav>

<div class="container">
    <div class="card">
        <div class="status-header">
            <div>
                <h1>Booking Details</h1>
                <p style="color: #666; margin-top: 5px;">
                    <strong>Confirmation Code:</strong> <span
                        th:text="${booking.confirmationCode}">CONF-20241215-000001</span>
                </p>
            </div>
            <div>
                    <span th:class="'badge badge-' + ${#strings.toLowerCase(booking.bookingStatus)}"
                          th:text="${#strings.replace(booking.bookingStatus, '_', ' ')}">CONFIRMED</span>
                <span th:if="${booking.paymentStatus != null}"
                      class="badge payment-badge"
                      th:text="${#strings.replace(booking.paymentStatus, '_', ' ')}"
                      style="margin-left: 10px;">PAID</span>
            </div>
        </div>

        <h3 style="color: #667eea; margin-bottom: 20px;">Booking Information</h3>
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">Check-in Date</div>
                <div class="info-value" th:text="${#temporals.format(booking.checkInDate, 'EEEE, MMM dd, yyyy')}">
                    Monday, Dec 01, 2024
                </div>
            </div>

            <div class="info-item">
                <div class="info-label">Check-out Date</div>
                <div class="info-value" th:text="${#temporals.format(booking.checkOutDate, 'EEEE, MMM dd, yyyy')}">
                    Monday, Dec 08, 2024
                </div>
            </div>

            <div class="info-item">
                <div class="info-label">Number of Nights</div>
                <div class="info-value" th:text="${booking.nights + ' night' + (booking.nights != 1 ? 's' : '')}">7
                    nights
                </div>
            </div>

            <div class="info-item">
                <div class="info-label">Total Cost</div>
                <div class="info-value">
                    <span th:if="${booking.cost != null}" class="cost-display"
                          th:text="'$' + ${#numbers.formatDecimal(booking.cost, 1, 2)}">$525.00</span>
                    <span th:if="${booking.cost == null}" style="color: #999;">Free / No cost</span>
                </div>
            </div>

            <div class="info-item" th:if="${booking.checkInTime != null}">
                <div class="info-label">Preferred Check-in Time</div>
                <div class="info-value" th:text="${#temporals.format(booking.checkInTime, 'MMM dd, yyyy HH:mm')}">Dec
                    01, 2024 15:00
                </div>
            </div>

            <div class="info-item" th:if="${booking.checkOutTime != null}">
                <div class="info-label">Preferred Check-out Time</div>
                <div class="info-value" th:text="${#temporals.format(booking.checkOutTime, 'MMM dd, yyyy HH:mm')}">Dec
                    08, 2024 11:00
                </div>
            </div>

            <div class="info-item" th:if="${booking.actualCheckIn != null}">
                <div class="info-label">Actual Check-in</div>
                <div class="info-value" th:text="${#temporals.format(booking.actualCheckIn, 'MMM dd, yyyy HH:mm')}">Dec
                    01, 2024 15:30
                </div>
            </div>

            <div class="info-item" th:if="${booking.actualCheckOut != null}">
                <div class="info-label">Actual Check-out</div>
                <div class="info-value" th:text="${#temporals.format(booking.actualCheckOut, 'MMM dd, yyyy HH:mm')}">Dec
                    08, 2024 10:45
                </div>
            </div>

            <div class="info-item">
                <div class="info-label">Booked On</div>
                <div class="info-value" th:text="${#temporals.format(booking.createdAt, 'MMM dd, yyyy HH:mm')}">Nov 15,
                    2024 09:00
                </div>
            </div>

            <div class="info-item" th:if="${booking.assignedBy != null}">
                <div class="info-label">Booked By</div>
                <div class="info-value" th:text="${booking.assignedBy.username}">facilitator</div>
            </div>
        </div>

        <div class="section" th:if="${booking.location != null}">
            <h3>üìç Location Details</h3>
            <div class="location-card">
                <h4 th:text="${booking.location.locationName}">Downtown Community Center</h4>
                <p th:if="${booking.location.address != null}">
                    <strong>Address:</strong> <span th:text="${booking.location.address}">123 Main Street</span>
                </p>
                <p>
                    <strong>City:</strong> <span
                        th:text="${booking.location.city + ', ' + booking.location.state + ' ' + booking.location.zipCode}">Philadelphia, PA 19101</span>
                </p>
                <p th:if="${booking.location.phone != null}">
                    <strong>Phone:</strong> <span th:text="${booking.location.phone}">215-555-0101</span>
                </p>
                <p th:if="${booking.location.nightlyRate != null}">
                    <strong>Nightly Rate:</strong> <span
                        th:text="'$' + ${#numbers.formatDecimal(booking.location.nightlyRate, 1, 2)}">$75.00</span>
                </p>
                <p th:if="${booking.location.description != null}" style="margin-top: 10px;">
                    <strong>Description:</strong><br>
                    <span th:text="${booking.location.description}">Description of location</span>
                </p>
                <p th:if="${booking.location.amenities != null}" style="margin-top: 10px;">
                    <strong>Amenities:</strong> <span th:text="${booking.location.amenities}">WiFi, Kitchen, etc</span>
                </p>
            </div>
        </div>

        <div class="section">
            <h3>üë§ Participant & Referral Information</h3>
            <div class="referral-card">
                <h4>Participant: <span th:text="${booking.referral.participantName}">John Doe</span></h4>
                <p th:if="${booking.referral.participantEmail != null}">
                    <strong>Email:</strong> <span th:text="${booking.referral.participantEmail}">john@example.com</span>
                </p>
                <p th:if="${booking.referral.participantPhone != null}">
                    <strong>Phone:</strong> <span th:text="${booking.referral.participantPhone}">555-0101</span>
                </p>
                <p><strong>Referral #:</strong> <span th:text="${booking.referral.referralNumber}">REF-001</span></p>
                <p><strong>Referred by:</strong> <span
                        th:text="${booking.referral.referredByCharity}">Hope Foundation</span></p>
                <p style="margin-top: 10px;"><strong>Participant Needs:</strong></p>
                <p th:text="${booking.referral.needsDescription}">Description of participant needs...</p>
                <a th:href="@{/facilitator/referrals/{id}(id=${booking.referral.id})}"
                   class="btn btn-referral"
                   style="margin-top: 15px; display: inline-block; padding: 8px 16px; font-size: 13px;">
                    View Full Referral ‚Üí
                </a>
            </div>
        </div>

        <div class="section" th:if="${booking.paymentMethod != null || booking.paidBy != null}">
            <h3>üí≥ Payment Information</h3>
            <div class="info-grid">
                <div class="info-item" th:if="${booking.paymentMethod != null}">
                    <div class="info-label">Payment Method</div>
                    <div class="info-value" th:text="${booking.paymentMethod}">Credit Card</div>
                </div>

                <div class="info-item" th:if="${booking.paymentStatus != null}">
                    <div class="info-label">Payment Status</div>
                    <div class="info-value" th:text="${#strings.replace(booking.paymentStatus, '_', ' ')}">PAID</div>
                </div>

                <div class="info-item" th:if="${booking.paidBy != null}">
                    <div class="info-label">Paid By</div>
                    <div class="info-value" th:text="${booking.paidBy}">Hope Foundation</div>
                </div>

                <div class="info-item" th:if="${booking.externalBookingReference != null}">
                    <div class="info-label">External Reference</div>
                    <div class="info-value" th:text="${booking.externalBookingReference}">EXT-12345</div>
                </div>
            </div>
        </div>

        <div class="notes-section"
             th:if="${booking.specialInstructions != null && !#strings.isEmpty(booking.specialInstructions)}">
            <h4>üìã Special Instructions</h4>
            <p th:text="${booking.specialInstructions}">Ground floor room needed...</p>
        </div>

        <div class="notes-section" th:if="${booking.notes != null && !#strings.isEmpty(booking.notes)}">
            <h4>üìù Booking Notes</h4>
            <p th:text="${booking.notes}">General notes about this booking...</p>
        </div>

        <div class="notes-section" th:if="${booking.adminNotes != null && !#strings.isEmpty(booking.adminNotes)}">
            <h4>üîí Admin Notes (Internal)</h4>
            <p th:text="${booking.adminNotes}">Admin notes with timestamps...</p>
        </div>

        <div class="action-buttons">
            <a th:href="@{/facilitator/bookings}" class="btn btn-back">‚Üê Back to Bookings</a>

            <div style="margin-left: auto; display: flex; gap: 15px;">
                <button th:if="${booking.bookingStatus.name() == 'CONFIRMED' || booking.bookingStatus.name() == 'PENDING'}"
                        onclick="showCheckInModal()"
                        class="btn btn-checkin">‚úì Check In
                </button>

                <button th:if="${booking.bookingStatus.name() == 'CHECKED_IN'}"
                        onclick="showCheckOutModal()"
                        class="btn btn-checkout">Check Out
                </button>

                <button th:if="${booking.bookingStatus.name() != 'CANCELLED' && booking.bookingStatus.name() != 'COMPLETED'}"
                        onclick="showUpdateStatusModal()"
                        class="btn btn-back">Update Status
                </button>

                <button th:if="${booking.bookingStatus.name() != 'CANCELLED' && booking.bookingStatus.name() != 'COMPLETED'}"
                        onclick="showCancelModal()"
                        class="btn btn-cancel">Cancel Booking
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Check-in Modal -->
<div id="checkinModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Check In Guest</h2>
        </div>
        <form th:action="@{/facilitator/bookings/{id}/checkin(id=${booking.id})}" method="post">
            <div class="form-group">
                <label for="checkinNotes">Check-in Notes (Optional)</label>
                <textarea id="checkinNotes" name="notes" rows="3"
                          placeholder="Add any notes about check-in..."></textarea>
            </div>
            <div class="button-group">
                <button type="button" onclick="closeModal('checkinModal')" class="btn btn-modal-cancel">Cancel</button>
                <button type="submit" class="btn btn-checkin">Confirm Check-in</button>
            </div>
        </form>
    </div>
</div>

<!-- Check-out Modal -->
<div id="checkoutModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Check Out Guest</h2>
        </div>
        <form th:action="@{/facilitator/bookings/{id}/checkout(id=${booking.id})}" method="post">
            <div class="form-group">
                <label for="checkoutNotes">Check-out Notes (Optional)</label>
                <textarea id="checkoutNotes" name="notes" rows="3"
                          placeholder="Add any notes about check-out..."></textarea>
            </div>
            <div class="button-group">
                <button type="button" onclick="closeModal('checkoutModal')" class="btn btn-modal-cancel">Cancel</button>
                <button type="submit" class="btn btn-checkout">Confirm Check-out</button>
            </div>
        </form>
    </div>
</div>

<!-- Update Status Modal -->
<div id="statusModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Update Booking Status</h2>
        </div>
        <form th:action="@{/facilitator/bookings/{id}/status(id=${booking.id})}" method="post">
            <div class="form-group">
                <label for="status">New Status *</label>
                <select id="status" name="status" required>
                    <option value="">Select status</option>
                    <option value="PENDING">Pending</option>
                    <option value="CONFIRMED">Confirmed</option>
                    <option value="CHECKED_IN">Checked In</option>
                    <option value="CHECKED_OUT">Checked Out</option>
                    <option value="COMPLETED">Completed</option>
                    <option value="NO_SHOW">No Show</option>
                    <option value="CANCELLED">Cancelled</option>
                </select>
            </div>
            <div class="form-group">
                <label for="completionNotes">Notes</label>
                <textarea id="completionNotes" name="completionNotes" rows="4"
                          placeholder="Add any notes about the status update..."></textarea>
            </div>
            <div class="button-group">
                <button type="button" onclick="closeModal('statusModal')" class="btn btn-modal-cancel">Cancel</button>
                <button type="submit" class="btn btn-checkin">Update Status</button>
            </div>
        </form>
    </div>
</div>

<!-- Cancel Modal -->
<div id="cancelModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Cancel Booking</h2>
        </div>
        <form th:action="@{/facilitator/bookings/{id}/cancel(id=${booking.id})}" method="post">
            <div class="form-group">
                <label for="reason">Cancellation Reason *</label>
                <textarea id="reason" name="reason" rows="4"
                          placeholder="Please provide a reason for cancellation..." required></textarea>
            </div>
            <div class="button-group">
                <button type="button" onclick="closeModal('cancelModal')" class="btn btn-modal-cancel">Cancel</button>
                <button type="submit" class="btn btn-cancel">Confirm Cancellation</button>
            </div>
        </form>
    </div>
</div>

<script>
    function showCheckInModal() {
        document.getElementById('checkinModal').style.display = 'block';
    }

    function showCheckOutModal() {
        document.getElementById('checkoutModal').style.display = 'block';
    }

    function showUpdateStatusModal() {
        document.getElementById('statusModal').style.display = 'block';
    }

    function showCancelModal() {
        document.getElementById('cancelModal').style.display = 'block';
    }

    function closeModal(modalId) {
        document.getElementById(modalId).style.display = 'none';
    }

    window.onclick = function (event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
        }
    }
</script>
</body>
</html>