<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - SafelyNested</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .sidebar {
            position: sticky;
            top: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .sidebar .nav-link {
            color: #333;
            padding: 12px 20px;
            border-left: 3px solid transparent;
            transition: all 0.2s;
        }

        .sidebar .nav-link:hover {
            background: #f8f9fa;
            border-left-color: #667eea;
        }

        .sidebar .nav-link.active {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }

        .sidebar .nav-link i {
            width: 24px;
        }

        .doc-content {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 40px;
        }

        .doc-content h1 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }

        .doc-content h2 {
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .doc-content h3 {
            color: #555;
            margin-top: 25px;
            margin-bottom: 10px;
        }

        .step-list {
            counter-reset: step-counter;
            list-style: none;
            padding-left: 0;
        }

        .step-list li {
            counter-increment: step-counter;
            position: relative;
            padding-left: 50px;
            margin-bottom: 20px;
        }

        .step-list li::before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 0;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }

        .feature-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
        }

        .feature-card h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .tip-box {
            background: #e7f3ff;
            border: 1px solid #b6d4fe;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0;
        }

        .tip-box i {
            color: #0d6efd;
        }

        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffecb5;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0;
        }

        .warning-box i {
            color: #ffc107;
        }

        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 5px;
        }

        .role-admin { background: #667eea; color: white; }
        .role-charity { background: #28a745; color: white; }
        .role-facilitator { background: #17a2b8; color: white; }
        .role-donor { background: #ffc107; color: #333; }
        .role-location { background: #6c757d; color: white; }
        .role-global-facilitator { background: #e83e8c; color: white; }
    </style>
</head>
<body>
<nav class="navbar navbar-dark">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">
            <i class="fas fa-book me-2"></i>SafelyNested Documentation
        </span>
        <a th:href="@{/home}" class="btn btn-outline-light btn-sm">
            <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
        </a>
    </div>
</nav>

<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
            <div class="sidebar p-3">
                <h6 class="text-muted text-uppercase mb-3 px-3">Documentation</h6>
                <nav class="nav flex-column">
                    <a class="nav-link" th:classappend="${activeSection == 'overview'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='overview')}">
                        <i class="fas fa-home me-2"></i>Overview
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'admin'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='admin')}">
                        <i class="fas fa-user-shield me-2"></i>Admin Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'charity-partner'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='charity-partner')}">
                        <i class="fas fa-hands-helping me-2"></i>Charity Partner Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'charity-facilitator'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='charity-facilitator')}">
                        <i class="fas fa-user-tie me-2"></i>Charity Facilitator Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'facilitator'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='facilitator')}">
                        <i class="fas fa-user-cog me-2"></i>Facilitator Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'donor'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='donor')}">
                        <i class="fas fa-hand-holding-heart me-2"></i>Donor Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'location-admin'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='location-admin')}">
                        <i class="fas fa-map-marker-alt me-2"></i>Location Admin Guide
                    </a>
                    <a class="nav-link" th:classappend="${activeSection == 'stay-partners'} ? 'active' : ''"
                       th:href="@{/admin/documentation(section='stay-partners')}">
                        <i class="fas fa-building me-2"></i>Stay Partners
                    </a>
                </nav>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-9">
            <div class="doc-content">

                <!-- ============================================ -->
                <!-- OVERVIEW SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'overview'}">
                    <h1><i class="fas fa-home me-2"></i>SafelyNested Platform Overview</h1>

                    <p class="lead">SafelyNested is a comprehensive housing assistance platform that connects donors with charities to provide emergency and transitional housing for those in need.</p>

                    <h2>How It Works</h2>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-donate text-success me-2"></i>Donations</h4>
                                <p>Donors contribute funds to partner charities. A small fee (10% total) supports platform operations, while 90% goes directly to housing.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-bed text-primary me-2"></i>Funded Stays</h4>
                                <p>Donations directly fund accommodation bookings. Each booking tracks which donation funded it and how much was used.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-user-shield text-info me-2"></i>Privacy Protection</h4>
                                <p>Beneficiary information is protected. Donors see funded stays without any personally identifiable information about participants.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-chart-line text-warning me-2"></i>Impact Tracking</h4>
                                <p>Donors can track their impact through dashboards and funding reports showing exactly which stays their donations funded.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-building text-secondary me-2"></i>Stay Partners</h4>
                                <p>Hotels, property owners, and organisations can apply to become Stay Partners, providing accommodation locations for the platform.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="feature-card">
                                <h4><i class="fas fa-file-invoice-dollar text-danger me-2"></i>Full Accountability</h4>
                                <p>The Funding Report shows a clear trail from donation to stay, so every dollar is accounted for and transparent.</p>
                            </div>
                        </div>
                    </div>

                    <h2>Platform Flow</h2>
                    <ol class="step-list">
                        <li><strong>Donor contributes</strong> &mdash; Admin records the donation against a charity. Fees are calculated and the net amount is available for funding stays.</li>
                        <li><strong>Charity refers a participant</strong> &mdash; A Charity Partner creates a referral (directly or via an invite link) for someone needing housing.</li>
                        <li><strong>Facilitator approves and books</strong> &mdash; A Facilitator reviews the referral, approves it, and creates a booking at an available location. The booking can be funded from an available donation.</li>
                        <li><strong>Participant stays</strong> &mdash; The participant checks in, stays, and checks out. The booking status is updated throughout.</li>
                        <li><strong>Impact is tracked</strong> &mdash; Donors see funded stays on their dashboard, impact page, and funding report &mdash; all without seeing participant details.</li>
                    </ol>

                    <h2>User Roles</h2>
                    <table class="table table-bordered">
                        <thead class="table-light">
                            <tr>
                                <th>Role</th>
                                <th>Description</th>
                                <th>Primary Responsibilities</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><span class="role-badge role-admin">Admin</span></td>
                                <td>System administrator</td>
                                <td>Manage users, charities, donors, donations, funding reports, stay partner applications</td>
                            </tr>
                            <tr>
                                <td><span class="role-badge role-charity">Charity Partner</span></td>
                                <td>Charity staff member</td>
                                <td>Create referrals, manage invites, upload documents, manage locations, request donor setup</td>
                            </tr>
                            <tr>
                                <td><span class="role-badge role-facilitator">Charity Facilitator</span></td>
                                <td>Charity operations manager</td>
                                <td>Approve referrals, create and manage bookings (including donation-funded), check-in/check-out</td>
                            </tr>
                            <tr>
                                <td><span class="role-badge role-global-facilitator">Facilitator</span></td>
                                <td>Global operations manager</td>
                                <td>Same as Charity Facilitator but with system-wide access across all charities</td>
                            </tr>
                            <tr>
                                <td><span class="role-badge role-donor">Donor</span></td>
                                <td>Financial contributor</td>
                                <td>View donations, track impact, see funded stays via funding report</td>
                            </tr>
                            <tr>
                                <td><span class="role-badge role-location">Location Admin</span></td>
                                <td>Property manager</td>
                                <td>Manage shelter locations, nightly rates, and availability</td>
                            </tr>
                        </tbody>
                    </table>

                    <h2>Fee Structure</h2>
                    <div class="tip-box">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Transparent Fees:</strong> Every donation has a clear breakdown showing where funds go.
                    </div>
                    <ul>
                        <li><strong>Platform Fee (7%):</strong> Supports SafelyNested operations and technology</li>
                        <li><strong>Facilitator Fee (3%):</strong> Goes to the anchor charity for coordination</li>
                        <li><strong>Net Amount (90%):</strong> Available to fund accommodation stays</li>
                    </ul>
                </div>

                <!-- ============================================ -->
                <!-- ADMIN GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'admin'}">
                    <h1><i class="fas fa-user-shield me-2"></i>Administrator Guide</h1>

                    <p class="lead">As an administrator, you have full access to manage all aspects of the SafelyNested platform.</p>

                    <h2>User Management</h2>
                    <h3>Creating a New User</h3>
                    <ol class="step-list">
                        <li>Navigate to <strong>User Management</strong> from the dashboard</li>
                        <li>Click <strong>Create New User</strong></li>
                        <li>Fill in the user details (username, email, password)</li>
                        <li>Select the appropriate role for the user</li>
                        <li>If the user is a Charity Partner or Facilitator, assign them to a charity</li>
                        <li>Click <strong>Save</strong> to create the account</li>
                    </ol>

                    <div class="tip-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> When creating Charity Partner users, always assign them to a charity so they can only see data relevant to their organization.
                    </div>

                    <h3>Disabling/Reactivating Users</h3>
                    <p>Instead of permanently deleting users (which could break historical records), you can disable them:</p>
                    <ul>
                        <li><strong>Disable:</strong> Prevents the user from logging in while preserving all their historical data</li>
                        <li><strong>Reactivate:</strong> Re-enables a previously disabled account</li>
                    </ul>

                    <h2>Charity Management</h2>
                    <h3>Adding a New Charity</h3>
                    <ol class="step-list">
                        <li>Go to <strong>Charity Management</strong></li>
                        <li>Click <strong>Create New Charity</strong></li>
                        <li>Enter the charity name, EIN/Tax ID, and contact information</li>
                        <li>Set the maximum referrals per month (optional limit)</li>
                        <li>Save the charity</li>
                    </ol>

                    <h3>Verifying Charities</h3>
                    <p>New charities should be verified before they can fully operate. Verification confirms the charity is legitimate and has agreed to platform terms. Use the <strong>Verify</strong> button on the charities list.</p>

                    <h3>Activating/Deactivating Charities</h3>
                    <p>Use the <strong>Toggle Active</strong> button to enable or disable a charity. Inactive charities cannot create new referrals or bookings.</p>

                    <h2>Donor Management</h2>
                    <h3>Creating a Donor Account</h3>
                    <ol class="step-list">
                        <li>Navigate to <strong>Donor Management</strong></li>
                        <li>Click <strong>Create New Donor</strong></li>
                        <li>Select donor type: <strong>Individual</strong> or <strong>Business/Organization</strong></li>
                        <li>Fill in contact details and create login credentials</li>
                        <li>Assign the donor to one or more charities they wish to support</li>
                        <li>Save the donor account</li>
                    </ol>

                    <h3>Editing a Donor</h3>
                    <p>From the donor detail page, click <strong>Edit Donor</strong> to update their information. You can:</p>
                    <ul>
                        <li>Change donor type between Individual and Business</li>
                        <li>Update personal/business details and contact information</li>
                        <li>Reset the donor's password (leave the password field blank to keep the current one)</li>
                        <li>Update charity assignments</li>
                        <li>Add verification notes</li>
                    </ul>

                    <h3>Donor Verification and Activation</h3>
                    <p>From the donor detail page you can:</p>
                    <ul>
                        <li><strong>Verify / Remove Verification:</strong> Confirms the donor's identity has been validated</li>
                        <li><strong>Activate / Deactivate Account:</strong> Controls whether the donor can log in</li>
                    </ul>

                    <h3>Recording Donations</h3>
                    <ol class="step-list">
                        <li>Go to the donor's detail page</li>
                        <li>Click <strong>Record Donation</strong></li>
                        <li>Select which charity the donation is for</li>
                        <li>Enter the gross donation amount</li>
                        <li>The system automatically calculates fees, net amount, and estimated nights funded</li>
                        <li>Add any notes and save</li>
                    </ol>

                    <div class="warning-box">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important:</strong> Donations should be recorded only after funds have been received.
                    </div>

                    <h3>Verifying and Rejecting Donations</h3>
                    <p>New donations start in <strong>Pending</strong> status. From the donor detail page:</p>
                    <ul>
                        <li><strong>Verify:</strong> Confirms the donation has been received. This makes the funds available for booking allocation.</li>
                        <li><strong>Reject:</strong> Marks the donation as rejected (e.g., if the payment bounced or was fraudulent).</li>
                    </ul>

                    <h3>Donation Usage Tracking</h3>
                    <p>The donor detail page shows each donation's usage with a progress bar:</p>
                    <ul>
                        <li><strong>Bookings Funded:</strong> How many stays have been funded from this donation</li>
                        <li><strong>Amount Used / Net Amount:</strong> A visual progress bar showing how much of the donation has been allocated to bookings</li>
                    </ul>

                    <h2>Funding Report</h2>
                    <p>The <strong>Funding Report</strong> (accessible from the home page) provides a comprehensive view of all donations and the stays they've funded.</p>

                    <h3>Report Features</h3>
                    <ul>
                        <li><strong>Summary stats:</strong> Donations with stays, total stays funded, total amount funded, amount remaining</li>
                        <li><strong>Filters:</strong> Search by donor name, filter by charity, filter by donation status</li>
                        <li><strong>Expandable rows:</strong> Click any donation row to see the bookings it funded, including participant name, location, dates, nights, funded amount, and booking status</li>
                    </ul>

                    <div class="tip-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> The admin funding report shows full participant details. The donor version of this report hides participant information for privacy.
                    </div>

                    <h2>Donor Setup Requests</h2>
                    <p>Charity Partners can submit requests to link existing donors or create new donor accounts. These requests appear under <strong>Donor Management &rarr; Setup Requests</strong>.</p>
                    <ul>
                        <li>Review the request details (donor info, charity, request type)</li>
                        <li><strong>Approve:</strong> Creates the donor account or links the existing donor to the charity</li>
                        <li><strong>Reject:</strong> Declines the request with a reason sent back to the charity partner</li>
                    </ul>

                    <h2>Stay Partner Applications</h2>
                    <p>Individuals and businesses can apply to become Stay Partners through a public form. Applications appear under <strong>Stay Partner Applications</strong> on the home page.</p>
                    <ol class="step-list">
                        <li>Review the application details (property info, contact, availability)</li>
                        <li>To approve: select a charity to assign the stay partner to, then click <strong>Approve</strong></li>
                        <li>To reject: provide a reason and click <strong>Reject</strong></li>
                    </ol>
                </div>

                <!-- ============================================ -->
                <!-- CHARITY PARTNER GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'charity-partner'}">
                    <h1><i class="fas fa-hands-helping me-2"></i>Charity Partner Guide</h1>

                    <p class="lead">As a Charity Partner, you help connect people in need with housing assistance through referrals, invitations, and coordination.</p>

                    <h2>Dashboard Overview</h2>
                    <p>Your dashboard shows key metrics for your charity:</p>
                    <ul>
                        <li>Active referrals and their status</li>
                        <li>Pending invites awaiting participant response</li>
                        <li>Recent activity and notifications</li>
                    </ul>

                    <h2>Creating Referrals</h2>
                    <h3>Direct Referral Method</h3>
                    <ol class="step-list">
                        <li>Click <strong>New Referral</strong> from the dashboard</li>
                        <li>Enter participant information (name, contact details)</li>
                        <li>Describe their housing needs</li>
                        <li>Set urgency level (Low, Medium, High, Urgent)</li>
                        <li>Indicate if documents are required</li>
                        <li>Submit the referral for facilitator review</li>
                    </ol>

                    <h3>Invite Link Method</h3>
                    <p>For participants who can select their own location:</p>
                    <ol class="step-list">
                        <li>Go to <strong>Invites</strong> section</li>
                        <li>Click <strong>Create New Invite</strong></li>
                        <li>Set allowed zip codes (optional filter for locations)</li>
                        <li>Generate the invite link</li>
                        <li>Share the link with the participant</li>
                        <li>Participant selects their preferred location via the link</li>
                        <li>A referral is automatically created when they complete the form</li>
                    </ol>

                    <div class="tip-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Invite links expire after 30 days. You can resend expired invites from the Invites list. Invites can also be cancelled if no longer needed.
                    </div>

                    <h3>Editing and Cancelling Referrals</h3>
                    <ul>
                        <li>Referrals in <strong>Pending</strong> status can be edited (update participant info, needs, urgency)</li>
                        <li>Any referral can be cancelled if the participant no longer needs assistance</li>
                    </ul>

                    <h2>Managing Documents</h2>
                    <p>Supporting documents (ID, proof of address, etc.) can be managed from the Documents section:</p>
                    <ul>
                        <li>Upload documents on behalf of participants</li>
                        <li>Participants can also upload documents via their invite link</li>
                        <li>Download previously uploaded documents</li>
                        <li>Delete documents that are no longer needed</li>
                    </ul>

                    <h2>Managing Locations</h2>
                    <p>Charity Partners can manage accommodation locations for their charity:</p>
                    <ol class="step-list">
                        <li>Go to <strong>Locations</strong> from the sidebar</li>
                        <li>Click <strong>Add New Location</strong></li>
                        <li>Enter the location name, address, and nightly rate</li>
                        <li>Save the location</li>
                    </ol>
                    <p>You can also edit locations, toggle them active/inactive, and delete them if no longer needed.</p>

                    <h2>Viewing Donors</h2>
                    <p>You can see donors who support your charity (read-only access):</p>
                    <ul>
                        <li>View donor names and contact information</li>
                        <li>See verification status and their donations to your charity</li>
                    </ul>

                    <h2>Donor Setup Requests</h2>
                    <p>If you need a new donor account created or want to link an existing donor to your charity:</p>
                    <ol class="step-list">
                        <li>Go to <strong>Donors &rarr; Setup</strong></li>
                        <li>Choose to <strong>Link Existing Donor</strong> (search by name) or <strong>Create New Donor</strong></li>
                        <li>Fill in the details and submit the request</li>
                        <li>An administrator will review and approve or reject the request</li>
                        <li>Track your request status under <strong>Setup Requests</strong></li>
                    </ol>

                    <h2>Charity Profile</h2>
                    <p>View and edit your charity's profile information including contact details, mission statement, and allowed zip codes.</p>
                </div>

                <!-- ============================================ -->
                <!-- CHARITY FACILITATOR GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'charity-facilitator'}">
                    <h1><i class="fas fa-user-tie me-2"></i>Charity Facilitator Guide</h1>

                    <p class="lead">As a Charity Facilitator, you review referrals, approve housing requests, and manage bookings for your charity.</p>

                    <h2>Dashboard</h2>
                    <p>Your facilitator dashboard provides quick access to:</p>
                    <ul>
                        <li><strong>Pending Referrals:</strong> Requests awaiting your review</li>
                        <li><strong>Active Bookings:</strong> Current and upcoming stays</li>
                        <li><strong>Key Stats:</strong> Total referrals, bookings, and their statuses</li>
                    </ul>

                    <h2>Reviewing Referrals</h2>
                    <h3>Approval Process</h3>
                    <ol class="step-list">
                        <li>Check the <strong>Referrals</strong> section for pending requests</li>
                        <li>Review participant information and needs description</li>
                        <li>Verify all required documents have been uploaded (if applicable)</li>
                        <li>Add facilitator notes if needed</li>
                        <li>Click <strong>Approve</strong> or <strong>Reject</strong> with a reason</li>
                    </ol>

                    <div class="warning-box">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Important:</strong> Always provide a clear reason when rejecting a referral so the Charity Partner can address any issues.
                    </div>

                    <p>You can filter referrals by status and search by participant name to find specific cases.</p>

                    <h2>Creating Bookings</h2>
                    <p>Once a referral is approved, you can create a booking:</p>
                    <ol class="step-list">
                        <li>Open the approved referral or go to <strong>Bookings &rarr; New Booking</strong></li>
                        <li>Select the referral (only approved referrals are available)</li>
                        <li>Select the check-in and check-out dates</li>
                        <li>Confirm or select the location</li>
                        <li>Add any special instructions for the property</li>
                        <li>Optionally select a <strong>funding donation</strong> to cover the cost (see below)</li>
                        <li>Save the booking &mdash; a confirmation code is generated automatically</li>
                    </ol>

                    <h3>Donation-Funded Bookings</h3>
                    <p>When creating a booking, you can fund it from a verified donation:</p>
                    <ul>
                        <li>The booking form shows available donations for the charity (those with remaining balance)</li>
                        <li>Select a donation to fund the stay &mdash; the system shows the donor name and available balance</li>
                        <li>The funded amount is automatically calculated based on the nightly rate and number of nights</li>
                        <li>The donation's usage is updated and tracked on the donor's detail page and the funding report</li>
                    </ul>

                    <div class="tip-box">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Tip:</strong> Only donations in Verified, Allocated, or Partially Used status with remaining balance appear as funding options.
                    </div>

                    <h2>Managing Bookings</h2>
                    <h3>Booking Statuses</h3>
                    <table class="table table-sm">
                        <tr><td><strong>Pending</strong></td><td>Booking created, awaiting confirmation or check-in</td></tr>
                        <tr><td><strong>Confirmed</strong></td><td>Booking confirmed with the location</td></tr>
                        <tr><td><strong>Checked In</strong></td><td>Participant has arrived at the location</td></tr>
                        <tr><td><strong>Checked Out</strong></td><td>Participant has departed</td></tr>
                        <tr><td><strong>Completed</strong></td><td>Stay fully completed and finalised</td></tr>
                        <tr><td><strong>Cancelled</strong></td><td>Booking was cancelled</td></tr>
                        <tr><td><strong>No Show</strong></td><td>Participant did not arrive</td></tr>
                    </table>

                    <h3>Check-in / Check-out</h3>
                    <p>Use the dedicated <strong>Check In</strong> and <strong>Check Out</strong> buttons on the booking detail page to update the participant's status. The system records the actual check-in and check-out times.</p>

                    <h3>Cancelling a Booking</h3>
                    <p>Bookings can be cancelled from the booking detail page. Cancelled bookings do not count toward donation usage.</p>
                </div>

                <!-- ============================================ -->
                <!-- FACILITATOR (GLOBAL) GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'facilitator'}">
                    <h1><i class="fas fa-user-cog me-2"></i>Facilitator Guide (Global)</h1>

                    <p class="lead">As a Facilitator, you have system-wide access to manage referrals and bookings across all charities.</p>

                    <div class="tip-box">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> The Facilitator role works identically to the Charity Facilitator role, but with access to <strong>all charities</strong> in the system rather than just one.
                    </div>

                    <h2>Dashboard</h2>
                    <p>Your dashboard shows system-wide statistics across all charities:</p>
                    <ul>
                        <li>Total referrals and bookings across the entire platform</li>
                        <li>Pending referrals requiring review</li>
                        <li>Active bookings and upcoming check-ins</li>
                    </ul>

                    <h2>Referrals</h2>
                    <p>You can view and manage referrals from <strong>all charities</strong>:</p>
                    <ul>
                        <li>Filter referrals by status or search by participant name</li>
                        <li>Approve or reject referrals with notes</li>
                        <li>The referral detail shows which charity created it</li>
                    </ul>

                    <h2>Bookings</h2>
                    <p>You can create and manage bookings across all charities:</p>
                    <ul>
                        <li>Create bookings for any approved referral in the system</li>
                        <li>Fund bookings from available donations for the relevant charity</li>
                        <li>Update booking status, check in/out participants, and cancel bookings</li>
                    </ul>

                    <p>See the <strong>Charity Facilitator Guide</strong> for detailed instructions on the referral approval process, booking creation (including donation-funded bookings), and status management.</p>
                </div>

                <!-- ============================================ -->
                <!-- DONOR GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'donor'}">
                    <h1><i class="fas fa-hand-holding-heart me-2"></i>Donor Guide</h1>

                    <p class="lead">Thank you for supporting SafelyNested! As a donor, you can track your contributions and see the real impact of your generosity.</p>

                    <h2>Your Dashboard</h2>
                    <p>The donor dashboard shows your contribution summary at a glance:</p>
                    <ul>
                        <li><strong>Total Donated:</strong> Your lifetime gross contributions</li>
                        <li><strong>Net to Housing:</strong> The amount that goes directly to funding stays (after fees)</li>
                        <li><strong>Stays Funded:</strong> How many accommodation stays your donations have funded</li>
                        <li><strong>Amount Used:</strong> How much of your net donations has been allocated to stays</li>
                        <li><strong>Balance Remaining:</strong> Funds still available to fund future stays</li>
                    </ul>
                    <p>The dashboard also shows your 5 most recent donations and the charities you support.</p>

                    <h2>Viewing Your Donations</h2>
                    <p>The <strong>My Donations</strong> page shows all your contributions with details:</p>
                    <ul>
                        <li>Donation date, gross amount, and net amount</li>
                        <li>Fee breakdown (platform fee + facilitator fee)</li>
                        <li>Which charity received the donation</li>
                        <li>Donation status (Pending, Verified, Allocated, Partially Used, Fully Used)</li>
                        <li>Amount used vs. available &mdash; shown as a progress bar per donation</li>
                    </ul>
                    <p>You can filter donations by charity using the dropdown at the top of the page.</p>

                    <h3>Donation Detail</h3>
                    <p>Click any donation to see its full detail, including:</p>
                    <ul>
                        <li>Complete fee breakdown</li>
                        <li>Situations funded by this donation (if applicable)</li>
                        <li>Individual stays funded &mdash; showing location, dates, nights, and funded amount (no participant details)</li>
                    </ul>

                    <h2>Understanding Your Impact</h2>
                    <p>The <strong>My Impact</strong> page shows the stays and situations your donations have helped fund:</p>
                    <ul>
                        <li><strong>Stays Funded:</strong> Cards showing each accommodation stay with location, dates, nights, and funded amount</li>
                        <li><strong>Situations:</strong> Anonymised descriptions of the situations your donations have supported, with progress tracking</li>
                    </ul>

                    <div class="tip-box">
                        <i class="fas fa-shield-alt me-2"></i>
                        <strong>Privacy Protected:</strong> You'll see location names, dates, and amounts but never personal details like participant names or contact information. This protects beneficiary privacy while showing you the real impact of your generosity.
                    </div>

                    <h2>Funding Report</h2>
                    <p>The <strong>Funding Report</strong> is a dedicated page that shows exactly which stays each of your donations has funded:</p>
                    <ul>
                        <li><strong>Summary stats:</strong> Total donated, stays funded, amount used, and balance remaining</li>
                        <li><strong>Per-donation breakdown:</strong> Each donation is shown as a card with a usage progress bar</li>
                        <li><strong>Funded stays table:</strong> For each donation, see a table of stays with location, check-in/check-out dates, nights, funded amount, and status</li>
                        <li>Donations with no funded stays yet show "No stays funded yet from this donation"</li>
                    </ul>

                    <h2>Charities You Support</h2>
                    <p>The <strong>Charities</strong> page lists the charities where your donations go. Click a charity to see:</p>
                    <ul>
                        <li>Your total contributions to that charity</li>
                        <li>Stats specific to that charity (donations, net funds, stays funded)</li>
                        <li>Your donation history with that charity</li>
                    </ul>

                    <h2>Your Profile</h2>
                    <p>The <strong>My Profile</strong> page shows your account information:</p>
                    <ul>
                        <li>Name and contact information</li>
                        <li>Business details (for business/organisation donors)</li>
                        <li>Verification status</li>
                    </ul>
                    <p>Contact your administrator if you need to update your profile information.</p>
                </div>

                <!-- ============================================ -->
                <!-- LOCATION ADMIN GUIDE SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'location-admin'}">
                    <h1><i class="fas fa-map-marker-alt me-2"></i>Location Admin Guide</h1>

                    <p class="lead">As a Location Admin, you manage shelter locations and their availability for housing assistance across the platform.</p>

                    <h2>Dashboard</h2>
                    <p>Your dashboard shows an overview of all locations in the system with key stats like total locations, active/inactive counts, and quick links to manage them.</p>

                    <h2>Managing Locations</h2>
                    <h3>Adding a New Location</h3>
                    <ol class="step-list">
                        <li>Go to <strong>Locations</strong> from your dashboard</li>
                        <li>Click <strong>Add New Location</strong></li>
                        <li>Enter the location name and full address</li>
                        <li>Assign the location to a charity</li>
                        <li>Set the nightly rate</li>
                        <li>Add any special notes or instructions</li>
                        <li>Save the location</li>
                    </ol>

                    <h3>Editing Locations</h3>
                    <p>Click on any location to view its details, then use the <strong>Edit</strong> button to update:</p>
                    <ul>
                        <li>Location name and address</li>
                        <li>Nightly rate</li>
                        <li>Notes and special instructions</li>
                    </ul>

                    <h3>Updating Nightly Rates</h3>
                    <p>Rates can be updated as needed. Rate changes apply to new bookings only &mdash; existing bookings keep their original rate.</p>

                    <div class="tip-box">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Note:</strong> The nightly rate is used to calculate how many nights a donation can fund, so keep rates accurate and up to date.
                    </div>

                    <h2>Location Status</h2>
                    <p>Locations can be toggled active or inactive:</p>
                    <ul>
                        <li><strong>Active:</strong> Available for new bookings and visible to participants selecting locations via invite links</li>
                        <li><strong>Inactive:</strong> Not available for new bookings (existing bookings are unaffected)</li>
                    </ul>

                    <h2>Filtering and Searching</h2>
                    <p>The locations list supports filtering by:</p>
                    <ul>
                        <li><strong>Charity:</strong> View locations for a specific charity</li>
                        <li><strong>Status:</strong> Active or inactive locations</li>
                        <li><strong>Search:</strong> Search by location name or address</li>
                    </ul>

                    <h2>Deleting Locations</h2>
                    <div class="warning-box">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Caution:</strong> Deleting a location is permanent. Consider deactivating a location instead if it may be needed again in the future. Locations with existing bookings should not be deleted.
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- STAY PARTNERS SECTION -->
                <!-- ============================================ -->
                <div th:if="${activeSection == 'stay-partners'}">
                    <h1><i class="fas fa-building me-2"></i>Stay Partners</h1>

                    <p class="lead">Stay Partners are hotels, property owners, and organisations that provide accommodation locations for SafelyNested participants.</p>

                    <h2>How It Works</h2>
                    <p>The Stay Partner programme allows accommodation providers to join the SafelyNested platform:</p>

                    <ol class="step-list">
                        <li><strong>Apply:</strong> Prospective Stay Partners fill out a public application form with their property details, location, availability, and contact information</li>
                        <li><strong>Review:</strong> An administrator reviews the application and verifies the property information</li>
                        <li><strong>Approve:</strong> If approved, the administrator assigns the Stay Partner to a charity and their location is added to the platform</li>
                        <li><strong>Active:</strong> The Stay Partner's location becomes available for bookings by facilitators</li>
                    </ol>

                    <h2>Public Application Form</h2>
                    <p>Prospective Stay Partners can access the application at <strong>/stay-partner/apply</strong>. The form collects:</p>
                    <ul>
                        <li>Property name and type</li>
                        <li>Full address and location details</li>
                        <li>Number of rooms/units available</li>
                        <li>Nightly rate</li>
                        <li>Availability and any restrictions</li>
                        <li>Contact information</li>
                    </ul>

                    <p>After submitting, applicants receive a confirmation page with an application number. They can check the status of their application at <strong>/stay-partner/status</strong>.</p>

                    <h2>Admin Review Process</h2>
                    <p>Administrators review Stay Partner applications from the <strong>Stay Partner Applications</strong> card on the home page:</p>
                    <ul>
                        <li>View all applications, filterable by status (Pending, Approved, Rejected)</li>
                        <li>Click an application to see full details</li>
                        <li><strong>Approve:</strong> Select a charity to assign the Stay Partner to, creating their location in the system</li>
                        <li><strong>Reject:</strong> Provide a reason for rejection</li>
                    </ul>

                    <h2>Application Statuses</h2>
                    <table class="table table-sm">
                        <tr><td><strong>Pending</strong></td><td>Application submitted, awaiting admin review</td></tr>
                        <tr><td><strong>Approved</strong></td><td>Application approved, location added to the platform</td></tr>
                        <tr><td><strong>Rejected</strong></td><td>Application declined with a reason</td></tr>
                    </table>
                </div>

            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
